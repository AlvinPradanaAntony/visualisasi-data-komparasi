<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Workspace - Model Data Comparison</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.fusioncharts.com/fusioncharts/latest/fusioncharts.js"></script>
    <script src="https://cdn.fusioncharts.com/fusioncharts/latest/fusioncharts.charts.js"></script>
    <script src="https://cdn.fusioncharts.com/fusioncharts/latest/themes/fusioncharts.theme.fusion.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/alpinejs" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body class="font-sans bg-gray-100 p-4 md:p-6 lg:p-8">
    <div id="preloader">
      <lottie-player src="https://assets10.lottiefiles.com/packages/lf20_p8bfn5to.json" background="transparent" speed="1" style="width: 150px; height: 150px" loop autoplay></lottie-player>
    </div>

    <!-- Toast system (from main page) -->
    <div
      x-data
      x-init="
            window.toast = function(message, options = {}){
                let description = options.description || '';
                let type = options.type || 'default';
                let position = options.position || 'top-center';
                let html = options.html || '';
                let saveToDb = options.saveToDb !== undefined ? options.saveToDb : true; // Default true

                if (saveToDb) {
                    saveNotificationToFirestore(message, { description, type });
                }

                if (window.Alpine) {
                     window.dispatchEvent(new CustomEvent('toast-show', { detail : { type: type, message: message, description: description, position : position, html: html }}));
                } else {
                    document.addEventListener('alpine:initialized', () => {
                         window.dispatchEvent(new CustomEvent('toast-show', { detail : { type: type, message: message, description: description, position : position, html: html }}));
                    });
                }
            }
        "
    >
      <!-- Same toast template from the main page -->
      <template x-teleport="body">
        <ul
          x-data="{
                    toasts: [],
                    toastsHovered: false,
                    expanded: false,
                    layout: 'default',
                    position: 'top-center',
                    paddingBetweenToasts: 15,
                    deleteToastWithId (id){ for(let i = 0; i < this.toasts.length; i++){ if(this.toasts[i].id === id){ this.toasts.splice(i, 1); break; } } },
                    burnToast(id){
                        let burnToast = this.getToastWithId(id);
                        if (!burnToast) return;
                        let burnToastElement = document.getElementById(burnToast.id);
                        if(burnToastElement){
                            if(this.toasts.length == 1){
                                if(this.layout=='default'){ this.expanded = false; }
                                burnToastElement.classList.remove('translate-y-0');
                                if(this.position.includes('bottom')){ burnToastElement.classList.add('translate-y-full'); }
                                else { burnToastElement.classList.add('-translate-y-full'); }
                            }
                            burnToastElement.classList.add('opacity-0');
                            let that = this;
                            setTimeout(function(){ that.deleteToastWithId(id); setTimeout(function(){ that.stackToasts(); }, 1); }, 300);
                        }
                    },
                    getToastWithId(id){ for(let i = 0; i < this.toasts.length; i++){ if(this.toasts[i].id === id){ return this.toasts[i]; } } return null; },
                    stackToasts(){ this.positionToasts(); this.calculateHeightOfToastsContainer(); let that = this; setTimeout(function(){ that.calculateHeightOfToastsContainer(); }, 300); },
                    positionToasts(){
                        if(this.toasts.length == 0) return;
                        let topToast = document.getElementById( this.toasts[0].id );
                        if (!topToast) return;
                        topToast.style.zIndex = 100;
                        if(this.expanded){
                            if(this.position.includes('bottom')){ topToast.style.top = 'auto'; topToast.style.bottom = '0px'; }
                            else { topToast.style.top = '0px'; }
                        }

                        if(this.toasts.length == 1) return;
                        let middleToast = document.getElementById( this.toasts[1].id );
                         if (!middleToast) return;
                        middleToast.style.zIndex = 90;
                        let middleToastPosition;
                        if(this.expanded){
                            middleToastPosition = topToast.getBoundingClientRect().height + this.paddingBetweenToasts + 'px';
                            if(this.position.includes('bottom')){ middleToast.style.top = 'auto'; middleToast.style.bottom = middleToastPosition; }
                            else { middleToast.style.top = middleToastPosition; }
                            middleToast.style.scale = '100%'; middleToast.style.transform = 'translateY(0px)';
                        } else {
                            middleToast.style.scale = '94%';
                            if(this.position.includes('bottom')){ middleToast.style.transform = 'translateY(-16px)'; }
                            else { this.alignBottom(topToast, middleToast); middleToast.style.transform = 'translateY(16px)'; }
                        }
                        
                        if(this.toasts.length == 2) return;
                        let bottomToast = document.getElementById( this.toasts[2].id );
                         if (!bottomToast) return;
                        bottomToast.style.zIndex = 80;
                        let bottomToastPosition;
                        if(this.expanded){
                             bottomToastPosition = topToast.getBoundingClientRect().height + this.paddingBetweenToasts + middleToast.getBoundingClientRect().height + this.paddingBetweenToasts + 'px';
                            if(this.position.includes('bottom')){ bottomToast.style.top = 'auto'; bottomToast.style.bottom = bottomToastPosition; }
                            else { bottomToast.style.top = bottomToastPosition; }
                            bottomToast.style.scale = '100%'; bottomToast.style.transform = 'translateY(0px)';
                        } else {
                            bottomToast.style.scale = '88%';
                            if(this.position.includes('bottom')){ bottomToast.style.transform = 'translateY(-32px)'; }
                            else { this.alignBottom(topToast, bottomToast); bottomToast.style.transform = 'translateY(32px)'; }
                        }

                        if(this.toasts.length > 3) {
                            for(let i = 3; i < this.toasts.length; i++) {
                                let excessToast = this.getToastWithId(this.toasts[i].id);
                                if (excessToast) {
                                    setTimeout(() => this.burnToast(excessToast.id), (i - 3) * 100);
                                }
                            }
                        }
                        return;
                    }
                }"
          class="fixed block w-full group z-[99] sm:max-w-xs"
          :class="{ 'right-0 top-0 sm:mt-6 sm:mr-6': position=='top-right', 'left-0 top-0 sm:mt-6 sm:ml-6': position=='top-left', 'left-1/2 -translate-x-1/2 top-0 sm:mt-6': position=='top-center', 'right-0 bottom-0 sm:mr-6 sm:mb-6': position=='bottom-right', 'left-0 bottom-0 sm:ml-6 sm:mb-6': position=='bottom-left', 'left-1/2 -translate-x-1/2 bottom-0 sm:mb-6': position=='bottom-center' }"
          x-cloak
        ></ul>
      </template>
    </div>

    <!-- Main content wrapper -->
    <div class="container mx-auto">
      <!-- Header with navigation -->
      <header class="mb-6">
        <nav class="flex items-center justify-between bg-white rounded-lg p-4 shadow-md">
          <div class="flex items-center space-x-4">
            <h1 class="text-xl font-bold text-gray-800">Model Data Workspace</h1>
          </div>
          <div class="flex items-center space-x-4">
            <a href="index.html" class="text-blue-600 hover:text-blue-800 font-medium">Kembali ke Beranda</a>
          </div>
        </nav>
      </header>

      <!-- Main content -->
      <div class="flex flex-col lg:flex-row gap-6">
        <!-- Model cards section -->
        <div class="lg:w-4/12 bg-white rounded-lg p-6 shadow-md">
          <h2 class="text-lg md:text-xl font-semibold mb-4 text-gray-700">Data Model yang Tersedia</h2>
          <p class="text-sm text-gray-500 mb-4">Drag & drop model ke workspace untuk membuat grafik perbandingan.</p>

          <div id="modelCardsContainer" class="grid gap-4 grid-cols-1 md:grid-cols-2">
            <!-- Model cards will be loaded here -->
            <div class="animate-pulse space-y-2">
              <div class="h-32 bg-gray-200 rounded-md"></div>
              <div class="h-4 bg-gray-200 rounded w-3/4"></div>
              <div class="h-3 bg-gray-200 rounded w-1/2"></div>
            </div>
            <div class="animate-pulse space-y-2">
              <div class="h-32 bg-gray-200 rounded-md"></div>
              <div class="h-4 bg-gray-200 rounded w-3/4"></div>
              <div class="h-3 bg-gray-200 rounded w-1/2"></div>
            </div>
          </div>
        </div>

        <!-- Workspace section -->
        <div class="lg:w-8/12 bg-white rounded-lg p-6 shadow-md">
          <h2 class="text-lg md:text-xl font-semibold mb-4 text-gray-700">Workspace Perbandingan</h2>
          <p class="text-sm text-gray-500 mb-4">Tambahkan model data untuk membandingkan skor benchmark.</p>

          <!-- Drop container -->
          <div id="modelDropContainer" class="border-2 border-dashed border-gray-300 rounded-lg p-6 min-h-[300px] flex flex-col items-center justify-center mb-6">
            <div id="emptyDropState" class="text-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
              </svg>
              <p class="text-gray-500">Drag & drop card data model ke sini</p>
            </div>

            <div id="droppedModelsContainer" class="w-full grid gap-4 grid-cols-1 md:grid-cols-2 hidden">
              <!-- Dropped model cards will appear here -->
            </div>
          </div>

          <!-- Action buttons -->
          <div class="flex flex-wrap gap-4">
            <button type="button" id="generateWorkspaceChartBtn" class="flex-1 basis-full sm:basis-auto bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md transition duration-200 text-sm md:text-base disabled:opacity-50 disabled:cursor-not-allowed">Buat Grafik</button>
            <button type="button" id="resetWorkspaceBtn" class="flex-1 basis-full sm:basis-auto bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-md transition duration-200 text-sm md:text-base">Reset Workspace</button>
          </div>

          <!-- Chart container -->
          <div id="workspaceChartContainer" class="mt-8 hidden">
            <h3 class="text-lg font-semibold mb-4 text-center text-gray-600">Grafik Perbandingan Skor</h3>
            <div id="workspaceChart"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Notification fab -->
    <div id="notificationFabContainer">
      <button type="button" id="viewNotificationBtn" title="Lihat Notifikasi">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341A6.002 6.002 0 006 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
        </svg>
        <span id="notificationBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center border-2 border-white hidden">0</span>
      </button>
    </div>

    <!-- Notification modal -->
    <div id="notificationModal" class="modal-overlay hidden">
      <div class="modal-content relative">
        <button id="closeNotificationModalBtn" class="modal-close-btn" title="Tutup">&times;</button>
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold text-gray-700">Pusat Notifikasi</h2>
          <button id="clearAllNotificationsBtn" class="text-xs bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded-md transition duration-200">Hapus Semua</button>
        </div>
        <div id="notificationList" class="space-y-2 max-h-96 overflow-y-auto">
          <div class="flex flex-col justify-center items-center h-32">
            <div class="loader mb-4"></div>
            <p class="shimmer-text text-gray-500 text-sm">Memuat notifikasi...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Clear notifications modal -->
    <div id="clearAllNotificationsConfirmModal" class="modal-overlay hidden">
      <div class="modal-content relative">
        <h3 class="text-lg font-semibold mb-3 text-gray-700">Konfirmasi Hapus Semua Notifikasi</h3>
        <p class="text-gray-600 mb-4">Apakah Anda yakin ingin menghapus SEMUA notifikasi? Tindakan ini tidak dapat diurungkan.</p>
        <div class="confirm-buttons">
          <button id="cancelClearAllNotificationsBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md transition duration-200">Batal</button>
          <button id="confirmClearAllNotificationsBtn" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-md transition duration-200">Ya, Hapus Semua</button>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
    <script src="workspace.js"></script>
  </body>
</html>
